<template>
  <div>
    <div class="table-toolbar">
      <v-text-field v-model="search"
                    :label="$t('serviceClients.searchPlaceHolder')"
                    single-line
                    hide-details
                    class="search-input">
        <v-icon slot="append">mdi-magnify</v-icon>
      </v-text-field>
      <v-btn
        color="primary"
        @click="addServiceClient"
        outlined
        rounded
        class="ma-0 rounded-button elevation-0"
      >{{$t('serviceClients.addServiceClient')}}
      </v-btn>
    </div>

    <v-card flat>
      <table class="xrd-table service-clients-table">
        <tr>
          <th>{{$t('serviceClients.name')}}</th>
          <th>{{$t('serviceClients.id')}}</th>
        </tr>
        <template v-if="serviceClients.length > 0">
          <tr v-for="sc in this.filteredServiceClients()" @click="showAccessRights(sc.id)">
            <td>{{sc.name}}</td>
            <td>{{sc.id}}</td>
          </tr>
        </template>
      </table>
    </v-card>

  </div>
</template>

<script lang="ts">
  import Vue from 'vue';
  import {mapGetters} from 'vuex';
  import * as api from '@/util/api';
  import {ServiceClient} from '@/types';

  export default Vue.extend({
    props: {
      id: {
        type: String,
        required: true,
      },
    },
    data() {
      return {
        serviceClients: [] as ServiceClient[],
        search: '' as string,
      };
    },
    computed: {
      ...mapGetters(['client']),
    },
    methods: {
      fetchServiceClients() {
        api.get(`/clients/${this.id}/service-clients`, {})
          .then( ( response: any ): void => this.serviceClients = response.data )
          .catch( (error: any) =>
            this.$store.dispatch('showError', error));
      },
      addServiceClient(): void {
        // NOOP
      },
      filteredServiceClients() {
        return this.serviceClients.filter( (sc: ServiceClient) => {
          const searchWordLowerCase = this.search.toLowerCase();
          return sc.name?.toLowerCase().includes(searchWordLowerCase)
            || sc.id.toLowerCase().includes(searchWordLowerCase);
        });
      },
      showAccessRights(serviceClientId: string) {
        this.$router.push(`/serviceclients/${serviceClientId}/accessrights/${this.id}`);
      },
    },
    created() {
      this.fetchServiceClients();
    },
  });
</script>

<style lang="scss" scoped>
@import '../../../assets/tables';

.search-input {
  max-width: 300px;
}

.service-clients-table {
  margin-top: 40px;
}

</style>
